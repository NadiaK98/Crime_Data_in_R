---
title: "Lubridate and Zoo"
author: "Simon Parker"
date: "20/07/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Lubridate

In these examples we are going to be using data reporting the number of daily Covid-19 cases between the 1st of March and the 19th of July in England.

Firstly, we need to load the packages that we are going to be using. For the first exercise we will need the lubridate package and ggplot2.

```{r load packages, message=FALSE, warning=FALSE, results='hide'}

library(lubridate)

library(ggplot2)

```

Now we'll need to load in our data. There is csv file in the ESS Data Folder named coronavirus-cases which we will be using. In the chunk below, I will be creating new object named 'Covid' from this data.

```{r load data}

Covid <- read.csv("C:/Users/Public/Documents/ESS-2020-Data/coronavirus-cases.csv", header = TRUE)

```

We will be using the Year, Month, and Day columns to produce a Date-class variable.
Lubridate allows us to produce a date in many formats using dmy(), myd(), ymd(), ydm(), dym(), mdy()

```{r create date variable}

Covid$Date <- dmy(paste(Covid$Day, Covid$Month, Covid$Year))  

```

Now we will have a date-class variable in our dataframe. R will be able to understand that this data has a temporal order, and so we can plot the daily cases over time using ggplot2. In this example we are simply using a line plot of data against daily cases. 

```{r ggplotting over time}

ggplot(Covid) + 
geom_line(aes(Date, Daily.cases)) +
ylab("Daily Cases")

```

## Zoo

In the previous example we were able to utilise existing columns to create our date-class variable. However there may be occasions when we don't have any date columns at all in our dataframe. We can use Zoo to generate a zoo series for us which will include ameasure of temporality.

First of all, load the packages we will be using in this exercise. We will be using the Zoo package to produce a zoo series, and dygraphs to produce a visualisation. We will also need the tidyverse package to manipulate the data.

```{r load packages zoo, message=FALSE, warning=FALSE, results='hide'}

library(zoo)

library(dygraphs)

library(tidyverse)

```

We want to create a new version of our Covid dataframe but this time only retaining the variables of interest 'Daily.cases' and `Cumulative.cases'. We can use the select function from the tidyverse package to do so.

```{r create dataframe}

Covid2 <- Covid %>% select(Daily.cases, Cumulative.cases)

```

Now we will use the Zoo package to convert  a date variable. The data is somewhat unusual in that the top of the data is actually the most recent date, as such we have to think of our start date for this data as the 19th of July, and the end date is the 1st of March. The 'by' option sets the increments, we want the dates to progress daily and so we will set this 1 (-1 in this example as we are 'going' backwards in time). If we set 'by' to 7, our dates would go in weekly increments, if we set it 0.25, we would get 6-hourly increments.

```{r create zoo series}

Covid2 <- zoo(Covid2, seq(from = as.Date("2020-07-19"), to = as.Date("2020-03-01"), by = -1))

```

The dygraphs package helps us produce visualisations over time with a date selector. This enables the reader to focus in on a particular period. The command to do so can be seen below. These integrate will with R Markdown as we can include interactive plots.

```{r create a dygraph}

dygraph(Covid2, main = "Covid-19 Daily Cases in the UK") %>% dyRangeSelector(dateWindow = c("2020-03-01", "2020-07-19"))

```
